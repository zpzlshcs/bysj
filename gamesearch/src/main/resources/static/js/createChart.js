var jsondata=
    {
        "4232": {
            "img": "疾步之靴.jpg",
            "装备价格": "530",
            "唯一被动 ": " +60移动速度",
            "name": "疾步之靴",
            "唯一被动 神行": " 脱离战斗后增加60移动速度",
            "type": "equip"
        },
        "8328": {
            "img": "冰痕之握.jpg",
            "装备价格": "2020",
            "最大法力": 500,
            "物理防御": 200,
            "唯一被动 咒刃": " 使用技能后，5秒内的下一次普攻造成范围30%减速和150点物理伤害（每升1级增加20点），这个效果有3秒冷却时间。",
            "name": "冰痕之握",
            "最大生命": 800,
            "type": "equip",
            "冷却缩减": 10
        },
        "16624": {
            "唯一被动 寒冰冲击": " 受到单次伤害超过当前生命值10%时触发寒冰冲击，对周围敌人造成伤害并降低其30%攻击和移动速度，持续2秒，这个效果有2秒内置CD",
            "img": "极寒风暴.jpg",
            "装备价格": "2100",
            "最大法力": 500,
            "物理防御": 360,
            "name": "极寒风暴",
            "type": "equip",
            "冷却缩减": 20
        },
        "28808": {
            "img": "时之预言.jpg",
            "法术攻击": 160,
            "装备价格": "2090",
            "最大法力": 600,
            "name": "时之预言",
            "唯一被动 守护": " 每5点法强提升1点物理和法术防御，最多提升200点。",
            "最大生命": 800,
            "type": "equip"
        },
        "32896": {
            "img": "神速之靴.jpg",
            "装备价格": "250",
            "唯一被动 ": " +30移动速度",
            "name": "神速之靴",
            "type": "equip"
        },
        "41184": {
            "img": "光辉之剑.jpg",
            "装备价格": "780",
            "最大法力": 400,
            "唯一被动 咒刃": " 使用技能后，下一次普通攻击附加法术伤害，这个效果有2秒的冷却时间",
            "name": "光辉之剑",
            "最大生命": 400,
            "type": "equip"
        },
        "57464": {
            "img": "布甲.jpg",
            "装备价格": "220",
            "物理防御": 90,
            "name": "布甲",
            "type": "equip"
        },
        "69752": {
            "img": "影忍之足.jpg",
            "装备价格": "710",
            "物理防御": 110,
            "唯一被动 ": " 减少15%受到普通攻击的伤害",
            "name": "影忍之足",
            "type": "equip"
        },
        "73848": {
            "img": "贤者之书.jpg",
            "法术攻击": 400,
            "唯一被动 刻印": " 增加1400点生命",
            "装备价格": "2990",
            "name": "贤者之书",
            "type": "equip"
        },
        "114800": {
            "img": "露娜.jpg",
            "暴击几率": 0,
            "生存能力：": 1,
            "法术吸血": 0,
            "物理吸血": 0,
            "物理护甲穿透": 0,
            "最大生命": 0,
            "移速": 0,
            "type": "hero",
            "冷却缩减": 0,
            "背景故事": "露娜出生在强大的魔道家族，从小被作为家族继承人培养。然而，一个冰冷的血月之夜，她的兄长杀掉了整个家族，除了她。 “想成为继承人可以让给你!为什么要这样做?哥哥。” “小妹，记得吗?闯入村庄的杀手挟持了你，我将他们全部杀光的事?其实，我不过是享受杀人。我对做继承人也没兴趣，就是单纯想杀人。” 魔道能赋予人力量，也能让人疯狂。露娜意识到，她的哥哥，已无法控制自己。 “那时候……我就敬仰你……哥哥，想成为你那样的强者。” “拔剑啊!那些小事，我统统忘了。” “但我不会忘记。杀了我，我愿意把生命还给你。” 兄长把剑收回剑鞘。 “没意思。”他说。“跟不反抗的人决斗，没意思。” 他拾起她的剑，轻松折断，然后离开。 露娜擦干了最后的眼泪。魔道的宿命，是一种多么恐怖的东西。不知不觉间，哥哥替她背负了这份罪恶。 只要变得更强，总有一天能再见面吧。我会找到你，然后做一个了结。 “燃烧的剑，燃烧的心!”",
            "法术攻击": 0,
            "英雄价格": "13888金币/ 588点券/",
            "技能效果：": 10,
            "攻速加成": 0,
            "物理攻击": 0,
            "英雄定位": "近战,魔法",
            "最大法力": 0,
            "物理防御": 0,
            "法术防御": 0,
            "生命回复": 0,
            "暴击效果": 2,
            "物理减伤率": 0.145,
            "法力回复": 0,
            "法术减伤率": 0.076,
            "韧性": 0,
            "攻击伤害：": 4,
            "上手难度：": 8,
            "name": "露娜",
            "攻击范围": 0,
            "法术护甲穿透": 0
        },
        "40980632": {
            "img": "魔女斗篷.jpg",
            "装备价格": "1870",
            "唯一被动 迷雾": " 脱离战斗3秒后刷新,获得一个吸收320~2000点法术伤害的护盾（护盾效果随英雄等级成长）",
            "法术防御": 360,
            "name": "魔女斗篷",
            "最大生命": 1000,
            "type": "equip"
        },
        "40988824": {
            "img": "不祥征兆.jpg",
            "装备价格": "2180",
            "物理防御": 270,
            "唯一被动 寒铁": " 受到攻击会减少攻击者30%攻击速度与15%移动速度",
            "name": "不祥征兆",
            "最大生命": 1200,
            "type": "equip"
        },
        "40992920": {
            "img": "红莲斗篷.jpg",
            "装备价格": "1830",
            "物理防御": 240,
            "name": "红莲斗篷",
            "唯一被动 献祭": " 每秒对身边的敌军造成100点法术伤害",
            "最大生命": 1200,
            "type": "equip"
        },
        "40997016": {
            "img": "近卫荣耀.jpg",
            "装备价格": "1510",
            "name": "近卫荣耀",
            "最大生命": 500,
            "移速": 5,
            "type": "equip",
            "唯一被动 军团": " 周围友军增加(30+英雄等级*2)点物理攻击和(60+英雄等级*4)点法术攻击"
        },
        "41124000": {
            "skillType": "主动技能一",
            "skillDesc": "太乙真人使用炉子炼制药剂，期间获得移速加成效果持续5秒，持续时间内可以随时停止炼制，停止炼制或达到最大炼制时间后，药剂会发生爆炸，对周围敌人造成法术伤害和晕眩，炼制时间越长，伤害越高，晕眩时间越长",
            "name": "意外事故",
            "type": "skill"
        },
        "41148488": {
            "skillType": "主动技能二",
            "skillDesc": "太乙真人的炉子伸出一只触手，把自己拉向触达的第一个单位，如果目标是敌方单位，还会额外受到法术伤害和短暂眩晕.",
            "name": "第三只手",
            "type": "skill"
        },
        "41320568": {
            "img": "甄姬.jpg",
            "暴击几率": 0,
            "生存能力：": 5,
            "法术吸血": 0,
            "物理吸血": 0,
            "物理护甲穿透": 0,
            "最大生命": 0,
            "移速": 0,
            "type": "hero",
            "冷却缩减": 0,
            "背景故事": "甄姬是以温柔仁慈闻名大陆的绝代美女，出身高贵，被认为流着古代圣者的血脉受到人们崇敬。她从小被教育要肩负责任，无私的净化世人。可所有小心谨慎都在遇到那个人时被打破。他大胆无畏而痴情的追求令她头晕目眩。“我全部的生命意义都是为了邂逅你。”“请接受卑微男子送上的赞美：若轻云之蔽月，若流风之回雪。”“翩若惊鸿，婉若游龙。”甄姬平静的心中产生涟漪，以及摆脱宿命束缚的想法。抛弃了家族与身份后，她如愿以偿。然而，新婚之夜出现在眼前的人既熟悉又陌生，曾经才华横溢的恋人，如今是撕下面具的陌生人;一面是风流潇洒的翩翩公子，一面是潜藏着恨意与疯狂的继承者。甄姬惊觉自己落入了圈套。曹氏真正想得到的，是她那自血脉中传承的力量。一切为时太晚。她卷入野心，阴谋和鲜血中无法自拔。除了随波逐流，似乎已没有选择。“明明说好了，要永远在一起……”",
            "法术攻击": 0,
            "英雄价格": "2888金币/ 588钻石/",
            "技能效果：": 6,
            "攻速加成": 0,
            "物理攻击": 0,
            "英雄定位": "远程,魔法",
            "最大法力": 0,
            "物理防御": 0,
            "法术防御": 0,
            "生命回复": 0,
            "暴击效果": 2,
            "物理减伤率": 0.126,
            "法力回复": 0,
            "法术减伤率": 0.076,
            "韧性": 0,
            "攻击伤害：": 8,
            "上手难度：": 3,
            "name": "甄姬",
            "攻击范围": 0,
            "法术护甲穿透": 0
        },
        "41365624": {
            "skillType": "被动技能",
            "skillDesc": "周围每次有敌方非英雄单位死亡时（包括小兵和野怪），太乙真人和周围的友方英雄都会额外获得25%金币",
            "name": "黄金闪闪",
            "type": "skill"
        },
        "82087952": {
            "img": "马可波罗.jpg",
            "暴击几率": 0,
            "生存能力：": 7,
            "法术吸血": 0,
            "物理吸血": 0,
            "物理护甲穿透": 0,
            "最大生命": 0,
            "移速": 0,
            "type": "hero",
            "冷却缩减": 0,
            "背景故事": "旅行者，冒险家，语言天才……人们这样称呼他，马可·波罗。他的家族曾富甲一方，父亲和叔叔都执掌着庞大的商队，生意从大陆的最西面一直延伸到中部的西域诸国。可惜的是，整个家族人丁凋零。马可·波罗尚未成年，父亲就已经去世了。他由叔叔马泰奥抚养长大。 马泰奥视他如同亲子，为侄儿提供了最好的教育条件。整个家就像庞大的图书馆，堆满了父亲和叔父从各地带回的珍贵典籍和手抄本，还有各种各样的罕见的机关和古董。马可·波罗喜欢听叔父讲他们年轻时的旅途故事，从地图上搜寻父亲的足迹所踏过的土地。当他年长一些后，开始热衷于拆装那些古怪的机关，精密的调试它们，并向大师达芬奇求学，请教深奥而奇妙的机关知识。 从大师口中，他听说了关于“死海文书”的故事。从古老的废墟中挖掘出的经卷，由商人高价收购带回，轰动了西方的土地，里面记载着闻所未闻的知识和机关。东方人似乎叫它“天书”。作为机关的权威，大师亲自鉴定了这珍贵的古籍，认为“死海文书”正是通往传说中知识根源的钥匙，并期待着它能被运用于机关制造。可惜事与愿违，文书不久后下落不明。 马可·波罗如同遭到雷霆直击。他直觉收购并带回文书的商人就是自己的父亲。自己却对父亲过去的经历一无所知。他匆匆辞别大师，回到家里四处搜寻，什么都没有找到。沮丧的马可波罗第一千零一次摆弄着望远镜睡去。他梦见了父亲远去的身影，还有报告父亲失踪的信使……忽然，他惊醒过来。信使从未报告过父亲的死亡，他只是一去不回。他突然记起那小小的玩具，父亲最后出门前塞到手心中的碎片：一片古老的，镌刻在石板上的铭文。 马可·波罗找出铭文，用精密的机关仪器来观察它。当阴影被投射到穹顶上，他看到了什么？一封信。许多年前，父亲留给独子的信。 “儿子：当你看到这些文字时，我已经不存在于王者大陆。不要伤心，这是每个知识的寻求者都会坦然接受的宿命。但不得不与你分离，也是令我追悔莫及的痛苦。请记住我爱你，我会永远在知识根源的另一端看着你。” 总督府的布告栏前，人头耸动。那里张贴着招募的告示，聘请勇敢无畏的冒险者前往遥远的东方大陆。接到手下报告的马泰奥匆匆赶来，目瞪口呆的看着侄儿一把撕下告示。他突然发现马可·波罗长成了风度翩翩的年轻人，腰间携带着心爱的双枪，就像兄长年轻时的模样。泪水布满苍老的面颊，他大声呐喊着试图喝止侄儿。通往知识的根源，那是条多么危险和坎坷的道路，没人比他更清楚。可马可·波罗仅仅转过身，朝着人群中的叔父优雅的鞠躬行礼，随即义无反顾踏入总督府。 “世界那么大，我想来看看。”",
            "法术攻击": 0,
            "英雄价格": "13888金币/ 388点券/",
            "技能效果：": 6,
            "攻速加成": 0,
            "物理攻击": 0,
            "英雄定位": "远程,物理",
            "最大法力": 0,
            "物理防御": 0,
            "法术防御": 0,
            "生命回复": 0,
            "暴击效果": 2,
            "物理减伤率": 0.131,
            "法力回复": 0,
            "法术减伤率": 0.076,
            "韧性": 0,
            "攻击伤害：": 5,
            "上手难度：": 6,
            "name": "马可波罗",
            "攻击范围": 0,
            "法术护甲穿透": 0
        },
        "82124952": {
            "img": "太乙真人.jpg",
            "暴击几率": 0,
            "生存能力：": 8,
            "法术吸血": 0,
            "物理吸血": 0,
            "物理护甲穿透": 0,
            "最大生命": 0,
            "移速": 0,
            "type": "hero",
            "冷却缩减": 0,
            "背景故事": "“吾太乙，天下第一的傻瓜师父，曾经犯下三桩错误。现在，要以生命去填补。”“吾也曾出入起源之地，也曾被君主奉为上宾，乃皇家认证的特级炼金术师是也。然而当吾参与奇迹的建造，难以遏止根源奥秘的诱惑……最终，最终……清醒过来时，已经带着启动奇迹的钥匙逃离起源之地。这是吾犯下的第一桩错误。“陈塘关最高长官的小儿子因心疾奄奄一息。吾用奇迹的钥匙替换了他病弱的心脏。既支撑孩子长大，也让吾得以逃过追捕，一举两得。”“徒儿哪吒平安长大。关城中没人是他的对手，无论吾炼成多么强大的武器，他也能运用自如，但他不是完整的人，吾很清楚。除了愤怒，徒儿再没有更多的情绪。这是承受过分力量的后遗症，也是吾犯下的第二桩错误。”“徒儿被召唤到起源之地，吾无法放下担忧随行同往。可吾禁不住再次接近知识根源的诱惑，重新尝试起终极的炼金术。啊，吾平生最大的错误，正莫过于此。”“炼金术使吾暴露踪迹，被投入大牢。哪吒徒儿来了，不仅救了我，还有同牢那只无耻又刻薄的炉子。它用谄媚的口气恭维着徒儿，花言巧语欺骗他，强行冒充吾的炼金炉……”“为这场逃亡付出代价的，是陈塘关。阴险的当权者，强迫长官大人剿灭海中的魔种。暴风雨中的关城，化作陷阱囚困了海中的魔种。倒灌的海水淹没了一切。徒儿的暴怒令他失控，濒死的魔种叫嚣着。吾拼命想要炼成屏障，但救下的，只有无声无息的身体。追究因果根源，一切都来自吾犯下的三桩大错。”“‘怂在弟子背后的家伙！没用的矮子……’狼狈的炉子破口大骂。”“说得对，吾，……一直被徒儿保护的人……没用的师父……如果还能有挽回错误的办法……只能是……”“‘喂喂！这不可能！除了当权者，没有凡人成功！……还有祭品，等价交换的祭品！’”“吾能办到的。一定……”“徒儿身体之中，有奇迹的钥匙；吾身体之中，有人的心脏。钥匙，无生命之物。心脏，生命之源。”“等价交换。”“‘加上我！’炉子跳了起来。‘我可不是普通的炉子！好歹也偷窥过那根源的奥秘，啧啧，若非那看门的钟馗……’”“魔道的火焰闪烁着，吾走入阵法……炼成的咒语灼烧着吾的身体。”“吾乃太乙，胆小的太乙，懦弱的太乙，傻瓜的太乙。”“徒儿，师父赋予你的枷锁，师父所犯下的错误，理所应当由师父来纠正！这才是作为师父所要身体力行的正确人生观！”眼前陷入黑暗。模模糊糊中，唯有聒噪的声音在搅扰叫嚷。胸腔里，已经感受不到心脏的跳动，反倒有团火在燃烧。“‘活过来了！’炉子不顾头上烟雾缭绕，猛地蹦起三丈高。‘哟，你也活着，不过被烧成了黑炭而已。’”“炉子炼成的巴掌狠狠打在脸上，把吾敲醒。吾睁开眼，与哪吒徒儿四目相对。”“奇迹，真正的奇迹……看不见的泪水，流淌在吾黑漆漆的脸上。”皇家认证，特级炼金术师是也！炉子也有资格证书",
            "法术攻击": 0,
            "英雄价格": "13888金币/ 588点券/",
            "技能效果：": 5,
            "攻速加成": 0,
            "物理攻击": 0,
            "英雄定位": "近战,魔法",
            "最大法力": 0,
            "物理防御": 0,
            "法术防御": 0,
            "生命回复": 0,
            "暴击效果": 0,
            "物理减伤率": 0.135,
            "法力回复": 0,
            "法术减伤率": 0,
            "韧性": 0,
            "攻击伤害：": 4,
            "上手难度：": 5,
            "name": "太乙真人",
            "攻击范围": 0,
            "法术护甲穿透": 0
        },
        "82145296": {
            "img": "后羿.jpg",
            "暴击几率": 0,
            "生存能力：": 3,
            "法术吸血": 0,
            "物理吸血": 0,
            "物理护甲穿透": 0,
            "最大生命": 0,
            "移速": 0,
            "type": "hero",
            "冷却缩减": 0,
            "背景故事": "往昔的世界湮没于时光中，新的人类领袖借助魔道与机关术，从废墟中建造起繁荣的文明。而魔道和机关也被作为战争武器使用。 后羿，英勇的神射手，被王者选中去执行机密的任务：破坏矗立在边境的魔道能量机关“日之塔”。 他出色的完成了任务，突破严密的防护破坏了九座高塔。然而，那种强大的力量也迷惑了他的心灵。他渴望将这份力量据为己有。 这份愿望如此强烈，当他潜入最后一座日之塔时，射出了特制的大箭。如同太阳般明亮的光辉被箭的轨迹所引导，涌入他的体内。 无穷的力量……自己，成为了最后的太阳。后羿感受到自己强大，可同时，那变得异常灵敏察觉到了不寻常的动向。 王者不会允许后羿盗取力量的行为。他甚至在很早之前，就决定要在日之塔毁灭的同时，将他扼杀。 怀抱着不甘与愤怒，拥抱太阳之辉的后羿，终究与太阳一同沉睡。但并不是所有人都将他遗忘…… 是否有一天，重生的太阳，会放射出更璀璨的光辉? 拭目以待吧。 “苏醒了，猎杀时刻!”",
            "法术攻击": 0,
            "英雄价格": "6888金币/ 388点券/",
            "技能效果：": 8,
            "攻速加成": 0,
            "物理攻击": 0,
            "英雄定位": "远程,物理",
            "最大法力": 0,
            "物理防御": 0,
            "法术防御": 0,
            "生命回复": 0,
            "暴击效果": 2,
            "物理减伤率": 0.125,
            "法力回复": 0,
            "法术减伤率": 0.076,
            "韧性": 0,
            "攻击伤害：": 6,
            "上手难度：": 6,
            "name": "后羿",
            "攻击范围": 0,
            "法术护甲穿透": 0
        },
        "82227216": {
            "img": "孙尚香.jpg",
            "暴击几率": 0,
            "生存能力：": 5,
            "法术吸血": 0,
            "物理吸血": 0,
            "物理护甲穿透": 0,
            "最大生命": 0,
            "移速": 0,
            "type": "hero",
            "冷却缩减": 0,
            "背景故事": "富庶的江南地区时常引来海盗和掠夺者的觊觎，甚至还有来自遥远扶桑的浪人骚扰。与他们对抗的，则是精力过剩的小公主孙尚香，以及她那把经过特殊改装的巨大枪炮。有时候是趾高气扬的“海盗公主”，有时候是端正社会法律的“风纪委员”，有时候是惩恶扬善的“怪盗女郎”……每当发生不妙事件时，就有无聊人士开出赌局，竞猜关于破坏力强大的神秘少女将会以什么样的英姿登场。快乐的日子没有持续太久。孙策将军遇刺身亡，他在遗嘱中竟然选择香香作为继承者!但香香断然拒绝：“王位什么的，才没有兴趣!本小姐更适合用炮火来开路……找出要让吴国成为一个怎样的国家!”最终，另一位兄长孙权继承了王位。他很快陷入为妹妹终身大事担忧的焦虑中。这方面连足智多谋的大都督都表示无能为力。没多久吴国向整个大陆公告：“征集英才!高官厚禄任君选择。条件：终身接收麻烦公主一名。”“大小姐驾到!统统闪开”",
            "法术攻击": 0,
            "英雄价格": "5888金币/ 588点券/",
            "技能效果：": 6,
            "攻速加成": 0,
            "物理攻击": 0,
            "英雄定位": "远程,物理",
            "最大法力": 0,
            "物理防御": 0,
            "法术防御": 0,
            "生命回复": 0,
            "暴击效果": 2,
            "物理减伤率": 0.129,
            "法力回复": 0,
            "法术减伤率": 0.076,
            "韧性": 0,
            "攻击伤害：": 7,
            "上手难度：": 7,
            "name": "孙尚香",
            "攻击范围": 0,
            "法术护甲穿透": 0
        },
        "82374672": {
            "skillType": "主动技能三",
            "skillDesc": "召唤替身傀儡，保护自己和周围一个血量最低的友方英雄，持续3秒，持续时间内自己或被保护的英雄死亡，会在2秒后复活获得一定生命值.复活时对周围的敌人造成法术伤害和减速.",
            "name": "大变活人",
            "type": "skill"
        },
        "relationship": [
            {
                "name": "技能属于",
                "sourceid": "41124000",
                "targetid": "82124952"
            },
            {
                "name": "技能属于",
                "sourceid": "41148488",
                "targetid": "82124952"
            },
            {
                "name": "技能属于",
                "sourceid": "41365624",
                "targetid": "82124952"
            },
            {
                "name": "英雄技能",
                "sourceid": "82124952",
                "targetid": "41124000"
            },
            {
                "name": "英雄技能",
                "sourceid": "82124952",
                "targetid": "41148488"
            },
            {
                "name": "英雄技能",
                "sourceid": "82124952",
                "targetid": "41365624"
            },
            {
                "name": "英雄技能",
                "sourceid": "82124952",
                "targetid": "82374672"
            },
            {
                "name": "合成需要",
                "sourceid": "4232",
                "targetid": "32896"
            },
            {
                "name": "合成需要",
                "sourceid": "8328",
                "targetid": "41184"
            },
            {
                "name": "合成需要",
                "sourceid": "8328",
                "targetid": "57464"
            },
            {
                "name": "推荐装备",
                "sourceid": "82124952",
                "targetid": "4232"
            },
            {
                "name": "推荐装备",
                "sourceid": "82124952",
                "targetid": "8328"
            },
            {
                "name": "推荐装备",
                "sourceid": "82124952",
                "targetid": "16624"
            },
            {
                "name": "推荐装备",
                "sourceid": "82124952",
                "targetid": "28808"
            },
            {
                "name": "推荐装备",
                "sourceid": "82124952",
                "targetid": "69752"
            },
            {
                "name": "推荐装备",
                "sourceid": "82124952",
                "targetid": "73848"
            },
            {
                "name": "推荐装备",
                "sourceid": "82124952",
                "targetid": "40980632"
            },
            {
                "name": "推荐装备",
                "sourceid": "82124952",
                "targetid": "40988824"
            },
            {
                "name": "推荐装备",
                "sourceid": "82124952",
                "targetid": "40992920"
            },
            {
                "name": "推荐装备",
                "sourceid": "82124952",
                "targetid": "40997016"
            },
            {
                "name": "压制",
                "sourceid": "82124952",
                "targetid": "41320568"
            },
            {
                "name": "压制",
                "sourceid": "82124952",
                "targetid": "82145296"
            },
            {
                "name": "被压制",
                "sourceid": "82124952",
                "targetid": "114800"
            },
            {
                "name": "被压制",
                "sourceid": "82124952",
                "targetid": "82227216"
            },
            {
                "name": "拍档英雄",
                "sourceid": "82124952",
                "targetid": "82087952"
            },
            {
                "name": "拍档英雄",
                "sourceid": "82124952",
                "targetid": "82227216"
            }
        ],
        "node": [
            {
                "uuid": "82124952",
                "name": "太乙真人",
                "color": "#FF0000"
            },
            {
                "uuid": "41124000",
                "name": "意外事故",
                "color": "#66CDAA"
            },
            {
                "uuid": "41148488",
                "name": "第三只手",
                "color": "#66CDAA"
            },
            {
                "uuid": "41365624",
                "name": "黄金闪闪",
                "color": "#66CDAA"
            },
            {
                "uuid": "82374672",
                "name": "大变活人",
                "color": "#66CDAA"
            },
            {
                "uuid": "4232",
                "name": "疾步之靴",
                "color": "#0000CD"
            },
            {
                "uuid": "32896",
                "name": "神速之靴",
                "color": "#0000CD"
            },
            {
                "uuid": "8328",
                "name": "冰痕之握",
                "color": "#0000CD"
            },
            {
                "uuid": "41184",
                "name": "光辉之剑",
                "color": "#0000CD"
            },
            {
                "uuid": "57464",
                "name": "布甲",
                "color": "#0000CD"
            },
            {
                "uuid": "16624",
                "name": "极寒风暴",
                "color": "#0000CD"
            },
            {
                "uuid": "28808",
                "name": "时之预言",
                "color": "#0000CD"
            },
            {
                "uuid": "69752",
                "name": "影忍之足",
                "color": "#0000CD"
            },
            {
                "uuid": "73848",
                "name": "贤者之书",
                "color": "#0000CD"
            },
            {
                "uuid": "40980632",
                "name": "魔女斗篷",
                "color": "#0000CD"
            },
            {
                "uuid": "40988824",
                "name": "不祥征兆",
                "color": "#0000CD"
            },
            {
                "uuid": "40992920",
                "name": "红莲斗篷",
                "color": "#0000CD"
            },
            {
                "uuid": "40997016",
                "name": "近卫荣耀",
                "color": "#0000CD"
            },
            {
                "uuid": "41320568",
                "name": "甄姬",
                "color": "#A020F0"
            },
            {
                "uuid": "82145296",
                "name": "后羿",
                "color": "#A020F0"
            },
            {
                "uuid": "114800",
                "name": "露娜",
                "color": "#A020F0"
            },
            {
                "uuid": "82227216",
                "name": "孙尚香",
                "color": "#A020F0"
            },
            {
                "uuid": "82087952",
                "name": "马可波罗",
                "color": "#A020F0"
            }
        ]
    };
var app;
newApp();
function newApp(){
    app = new Vue({
        el: '#app',
        data: {
            svg:null,
            timer:null,
            editor:null,
            simulation:null,
            linkGroup:null,
            linktextGroup:null,
            nodeGroup:null,
            nodetextGroup:null,
            nodesymbolGroup:null,
            nodebuttonGroup:null,
            nodebuttonAction:'',
            txx:{},
            tyy:{},
            colorList: ["#ff8373", "#f9c62c", "#a5ca34", "#6fce7a", "#70d3bd", "#ea91b0"],
            color5: '#ff4500',
            predefineColors: ['#ff4500', '#ff8c00', '#90ee90', '#00ced1', '#1e90ff', '#c71585'],
            defaultcr: 30,
            selectnodeid: 0,
            selectnodename: '',
            selectsourcenodeid: 0,
            selecttargetnodeid: 0,
            graph: {
                nodes: [],
                links: []
            },
            graphEntity: {
                uuid: 0,
                name: '',
                color: 'ff4500',
                r: 30,
                x: "",
                y: ""
            },
            dialogFormVisible: false,
            headers: {},
        },
        mounted() {
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");
            var str = '{ "' + header + '": "' + token + '"}';
            this.headers = eval('(' + str + ')');
            this.initgraph();
            this.updategraph();
        },
        created() {
            this.graph.nodes = jsondata.node;
            this.graph.links = jsondata.relationship;
        },
        methods: {
            btnaddsingle(){
                d3.select('.graphcontainer').style("cursor", "crosshair");//进入新增模式，鼠标变成＋
            },
            btndeletelink() {
                this.isdeletelink = true;
                d3.select('.link').attr("class", "link linkdelete"); // 修改鼠标样式为"+"
            },
            getmorenode() {
                var _this = this;
                var data = {domain: _this.domain, nodeid: _this.selectnodeid};
                $.ajax({
                    data: data,
                    type: "POST",
                    url: contextRoot + "getmorerelationnode",
                    success: function (result) {
                        if (result.code == 200) {
                            var newnodes = result.data.node;
                            var newships = result.data.relationship;
                            var oldnodescount = _this.graph.nodes.length;
                            newnodes.forEach(function (m) {
                                var sobj = _this.graph.nodes.find(function (x) {
                                    return x.uuid === m.uuid
                                })
                                if (typeof(sobj) == "undefined") {
                                    _this.graph.nodes.push(m);
                                }
                            })
                            var newnodescount = _this.graph.nodes.length;
                            if (newnodescount <= oldnodescount) {
                                _this.$message({
                                    message: '没有更多节点信息',
                                    type: 'success'
                                });
                                return;
                            }
                            newships.forEach(function (m) {
                                var sobj = _this.graph.links.find(function (x) {
                                    return x.uuid === m.uuid
                                })
                                if (typeof(sobj) == "undefined") {
                                    _this.graph.links.push(m);
                                }
                            })
                            _this.updategraph();
                        }
                    },
                    error: function (data) {
                    }
                });
            },
            initgraph(){
                var graphcontainer = d3.select(".graphcontainer");
                var width = graphcontainer._groups[0][0].offsetWidth;
                var height = window.screen.height - 154;//
                this.svg = graphcontainer.append("svg");
                this.svg.attr("width", width);
                this.svg.attr("height", height);
                this.simulation = d3.forceSimulation()
                    .force("link", d3.forceLink().distance(400).id(function (d) {
                        return d.uuid
                    }))
                    .force("charge", d3.forceManyBody().strength(-400))
                    .force("collide", d3.forceCollide().strength(-30))
                    .force("center", d3.forceCenter(width / 2, (height - 200) / 2));
                this.linkGroup = this.svg.append("g").attr("class", "line");
                this.linktextGroup = this.svg.append("g").attr("class", "linetext");
                this.nodeGroup = this.svg.append("g").attr("class", "node");
                this.nodetextGroup = this.svg.append("g").attr("class", "nodetext");
                this.nodesymbolGroup = this.svg.append("g").attr("class", "nodesymbol");
                this.nodebuttonGroup = this.svg.append("g").attr("class", "nodebutton");
                this.addmaker();
                this.addnodebutton();
                this.svg.on('click',function(){
                    d3.selectAll("use").classed("circle_opreate", true);
                }, 'false');
            },
            updategraph() {
                var _this = this;
                var lks = this.graph.links;
                var nodes = this.graph.nodes;
                var links = [];
                lks.forEach(function (m) {
                    var sourceNode = nodes.filter(function (n) {
                        return n.uuid === m.sourceid;
                    })[0];
                    if (typeof(sourceNode) == 'undefined') return;
                    var targetNode = nodes.filter(function (n) {
                        return n.uuid === m.targetid;
                    })[0];
                    if (typeof(targetNode) == 'undefined') return;
                    links.push({source: sourceNode.uuid, target: targetNode.uuid, lk: m});
                });
                if(links.length>0){
                    _.each(links, function(link) {
                        var same = _.where(links, {
                            'source': link.source,
                            'target': link.target
                        });
                        var sameAlt = _.where(links, {
                            'source': link.target,
                            'target': link.source
                        });
                        var sameAll = same.concat(sameAlt);
                        _.each(sameAll, function(s, i) {
                            s.sameIndex = (i + 1);
                            s.sameTotal = sameAll.length;
                            s.sameTotalHalf = (s.sameTotal / 2);
                            s.sameUneven = ((s.sameTotal % 2) !== 0);
                            s.sameMiddleLink = ((s.sameUneven === true) &&(Math.ceil(s.sameTotalHalf) === s.sameIndex));
                            s.sameLowerHalf = (s.sameIndex <= s.sameTotalHalf);
                            s.sameArcDirection = 1;
                            //s.sameArcDirection = s.sameLowerHalf ? 0 : 1;
                            s.sameIndexCorrected = s.sameLowerHalf ? s.sameIndex : (s.sameIndex - Math.ceil(s.sameTotalHalf));
                        });
                    });
                    var maxSame = _.chain(links)
                        .sortBy(function(x) {
                            return x.sameTotal;
                        })
                        .last()
                        .value().sameTotal;
                    _.each(links, function(link) {
                        link.maxSameHalf = Math.round(maxSame / 2);
                    });
                }
                // 更新连线 links
                var link = _this.linkGroup.selectAll(".line >path").data(links, function (d) {
                    return d.uuid;
                });
                link.exit().remove();
                var linkEnter = _this.drawlink(link);
                link = linkEnter.merge(link);
                // 更新连线文字
                var linktext = _this.linktextGroup.selectAll("text").data(links, function (d) {
                    return d.uuid;
                });
                linktext.exit().remove();
                var linktextEnter = _this.drawlinktext(linktext);
                linktext = linktextEnter.merge(linktext).text(function (d) {
                    return d.lk.name;
                });
                // 更新节点按钮组
                d3.selectAll(".nodebutton  >g").remove();
                var nodebutton = _this.nodebuttonGroup.selectAll(".nodebutton").data(nodes, function (d) {
                    return d
                });
                nodebutton.exit().remove();
                var nodebuttonEnter = _this.drawnodebutton(nodebutton);
                nodebutton = nodebuttonEnter.merge(nodebutton);
                // 更新节点
                var node = _this.nodeGroup.selectAll("circle").data(nodes, function (d) {
                    return d
                });
                node.exit().remove();
                var nodeEnter = _this.drawnode(node);
                node = nodeEnter.merge(node).text(function (d) {
                    return d.name;
                });
                // 更新节点文字
                var nodetext = _this.nodetextGroup.selectAll("text").data(nodes, function (d) {
                    return d.uuid
                });
                nodetext.exit().remove();
                var nodetextEnter = _this.drawnodetext(nodetext);
                nodetext = nodetextEnter.merge(nodetext).text(function (d) {
                    return d.name;
                });
                nodetext.append("title")// 为每个节点设置title
                    .text(function (d) {
                        return d.name;
                    });
                // 更新节点标识
                var nodesymbol = _this.nodesymbolGroup.selectAll("path").data(nodes, function (d) {
                    return d.uuid;
                });
                nodesymbol.exit().remove();
                var nodesymbolEnter = _this.drawnodesymbol(nodesymbol);
                nodesymbol = nodesymbolEnter.merge(nodesymbol);
                nodesymbol.attr("fill", "#e15500");
                nodesymbol.attr("display", function (d) {
                    if (typeof(d.hasfile) != "undefined" && d.hasfile > 0) {
                        return "block";
                    }
                    return "none";
                })
                _this.simulation.nodes(nodes).on("tick", ticked);
                _this.simulation.force("link").links(links);
                _this.simulation.alphaTarget(0).restart();
                function linkArc(d) {
                    var dx = (d.target.x - d.source.x),
                        dy = (d.target.y - d.source.y),
                        dr = Math.sqrt(dx * dx + dy * dy),
                        unevenCorrection = (d.sameUneven ? 0 : 0.5);
                    var curvature = 2,
                        arc = (1.0/curvature)*((dr * d.maxSameHalf) / (d.sameIndexCorrected - unevenCorrection));
                    if (d.sameMiddleLink) {
                        arc = 0;
                    }
                    var dd="M" + d.source.x + "," + d.source.y + "A" + arc + "," + arc + " 0 0," + d.sameArcDirection + " " + d.target.x + "," + d.target.y;
                    return dd;
                }
                function ticked() {
                    // 更新连线坐标
                    /*link.attr("x1", function (d) {
                        return d.source.x;
                       })
                        .attr("y1", function (d) {
                            return d.source.y;
                        })
                        .attr("x2", function (d) {
                            return d.target.x;
                        })
                        .attr("y2", function (d) {
                            return d.target.y;
                        });*/
                    link.attr("d", linkArc)
                    // 刷新连接线上的文字位置
                    /* linktext.attr("x", function (d) {
                         return (d.source.x + d.target.x) / 2;
                     })
                         .attr("y", function (d) {
                             return (d.source.y + d.target.y) / 2;
                         })*/
                    // 更新节点坐标
                    node.attr("cx", function (d) {
                        return d.x;
                    })
                        .attr("cy", function (d) {
                            return d.y;
                        });
                    // 更新节点操作按钮组坐标
                    nodebutton.attr("cx", function (d) {
                        return d.x;
                    })
                        .attr("cy", function (d) {
                            return d.y;
                        });
                    nodebutton.attr("transform", function (d) {
                        return "translate(" + d.x + "," + d.y+ ") scale(1)";
                    })
                    // 更新文字坐标
                    nodetext.attr("x", function (d) {
                        return d.x;
                    })
                        .attr("y", function (d) {
                            return d.y;
                        });
                    // 更新回形针坐标
                    nodesymbol.attr("transform", function (d) {
                        return "translate(" + (d.x + 8) + "," + (d.y - 30) + ") scale(0.015,0.015)";
                    })
                }
                // 鼠标滚轮缩放
                //_this.svg.call(d3.zoom().transform, d3.zoomIdentity);//缩放至初始倍数
                _this.svg.call(d3.zoom().on("zoom", function () {
                    d3.selectAll('.node').attr("transform",d3.event.transform);
                    d3.selectAll('.nodetext').attr("transform",d3.event.transform);
                    d3.selectAll('.line').attr("transform",d3.event.transform);
                    d3.selectAll('.linetext').attr("transform",d3.event.transform);
                    d3.selectAll('.nodesymbol').attr("transform",d3.event.transform);
                    d3.selectAll('.nodebutton').attr("transform",d3.event.transform);
                    //_this.svg.selectAll("g").attr("transform", d3.event.transform);
                }));
                _this.svg.on("dblclick.zoom", null); // 静止双击缩放
                //按钮组事件
                _this.svg.selectAll(".buttongroup").on("click", function (d,i) {
                    console.log(_this.nodebuttonAction);
                    console.log(d);
                    if (_this.nodebuttonAction) {
                        switch (_this.nodebuttonAction) {
                            case "EDIT":
                                _this.isedit = true;
                                _this.propactiveName = 'propedit';
                                _this.txx=d.x;
                                _this.tyy=d.y;
                                break;
                            case "MORE":
                                _this.getmorenode();
                                break;
                            case "CHILD":
                                _this.operatetype = 2;
                                _this.isbatchcreate = true;
                                _this.isedit = false;
                                break;
                            case "LINK":
                                _this.isaddlink = true;
                                _this.selectsourcenodeid=d.uuid;
                                break;
                            case "DELETE":
                                _this.selectnodeid=d.uuid;
                                var out_buttongroup_id='.out_buttongroup_'+i;
                                _this.deletenode(out_buttongroup_id);
                                break;
                        }
                        ACTION = '';//重置 ACTION
                    }
                });
                //按钮组事件绑定
                _this.svg.selectAll(".action_0").on("click", function (d) {
                    _this.nodebuttonAction='EDIT';
                });
                _this.svg.selectAll(".action_1").on("click", function (d) {
                    _this.nodebuttonAction='MORE';
                });
                _this.svg.selectAll(".action_2").on("click", function (d) {
                    _this.nodebuttonAction='CHILD';
                });
                _this.svg.selectAll(".action_3").on("click", function (d) {
                    _this.nodebuttonAction='LINK';
                });
                _this.svg.selectAll(".action_4").on("click", function (d) {
                    _this.nodebuttonAction='DELETE';
                });
            },
            createnode() {
                var _this = this;
                var data = _this.graphEntity;
                data.domain = _this.domain;

            },
            addmaker() {
                var arrowMarker = this.svg.append("marker")
                    .attr("id", "arrow")
                    .attr("markerUnits", "strokeWidth")
                    .attr("markerWidth", "20")//
                    .attr("markerHeight", "20")
                    .attr("viewBox", "0 -5 10 10")
                    .attr("refX", "22")// 13
                    .attr("refY", "0")
                    .attr("orient", "auto");
                var arrow_path = "M0,-5L10,0L0,5";// 定义箭头形状
                arrowMarker.append("path").attr("d", arrow_path).attr("fill", "#fce6d4");
            },
            addnodebutton() {
                var _this = this;
                var nodebutton = this.svg.append("defs").append("g")
                    .attr("id", "out_circle")
                var database = [1,1,1,1,1];
                var pie = d3.pie();
                var piedata = pie(database);
                var buttonEnter=nodebutton.selectAll(".buttongroup")
                    .data(piedata)
                    .enter()
                    .append("g")
                    .attr("class", function (d, i) {
                        return "action_" + i ;
                    });
                var arc = d3.arc()
                    .innerRadius(30)
                    .outerRadius(60);
                buttonEnter.append("path")
                    .attr("d", function (d) {
                        return arc(d)
                    })
                    .attr("fill", "#D2D5DA")
                    .style("opacity", 0.6)
                    .attr("stroke", "#f0f0f4")
                    .attr("stroke-width", 2);
                buttonEnter.append("text")
                    .attr("transform", function (d, i) {
                        return "translate(" + arc.centroid(d) + ")";
                    })
                    .attr("text-anchor", "middle")
                    .text(function (d, i) {
                        var zi = new Array()
                        zi[0] = "编辑";
                        zi[1] = "展开";
                        zi[2] = "追加";
                        zi[3] = "连线";
                        zi[4] = "删除";
                        return zi[i]
                    })
                    .attr("font-size", 10);
            },
            dragstarted(d) {
                if (!d3.event.active) this.simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
                d.fixed = true;
            },
            dragged(d) {
                d.fx = d3.event.x;
                d.fy = d3.event.y;
            },
            dragended(d) {
                if (!d3.event.active) this.simulation.alphaTarget(0);
            },
            drawnode(node) {
                var _this = this;
                var nodeEnter = node.enter().append("circle");
                nodeEnter.attr("r", function (d) {
                    if (typeof(d.r) != "undefined" && d.r != '') {
                        return d.r
                    }
                    return 30;
                });
                nodeEnter.attr("fill", function (d) {
                    if (typeof(d.color) != "undefined" && d.color != '') {
                        return d.color
                    }
                    return "#ff4500";
                });
                nodeEnter.style("opacity", 0.8);
                nodeEnter.style("stroke", function (d) {
                    if (typeof(d.color) != "undefined" && d.color != '') {
                        return d.color
                    }
                    return "#ff4500";
                });
                nodeEnter.style("stroke-opacity", 0.6);
                nodeEnter.append("title")// 为每个节点设置title
                    .text(function (d) {
                        return d.name;
                    })
                nodeEnter.on("mouseover", function (d, i) {
                    _this.timer = setTimeout(function () {
                        d3.select('#richContainer')
                            .style('position', 'absolute')
                            .style('left', d.x + "px")
                            .style('top', d.y + "px")
                            .style('display', 'block');
                        _this.editorcontent = "";
                        _this.showImageList = [];
                    }, 3000);
                });
                nodeEnter.on("mouseout", function (d, i) {
                    clearTimeout( _this.timer);
                });
                nodeEnter.on("dblclick", function (d) {
                    console.log("双击了节点")
                    // 双击事件
                    searchContent(d.name);
                });
                nodeEnter.on("mouseenter", function (d) {
                    var aa = d3.select(this)._groups[0][0];
                    if (aa.classList.contains("selected")) return;
                    d3.select(this).style("stroke-width", "6");
                });
                nodeEnter.on("mouseleave", function (d) {
                    var aa = d3.select(this)._groups[0][0];
                    if (aa.classList.contains("selected")) return;
                    d3.select(this).style("stroke-width", "2");
                });
                nodeEnter.on("click", function (d,i) { //点击节点
                    var out_buttongroup_id='.out_buttongroup_'+i;
                    // _this.svg.selectAll("use").classed("circle_opreate", true);
                    // _this.svg.selectAll(out_buttongroup_id).classed("circle_opreate", false);
                    _this.graphEntity = d;
                    _this.selectnodeid = d.uuid;
                    _this.selectnodename = d.name;

                    console.log(d.uuid)
                    console.log(d.name)
                });
                nodeEnter.call(d3.drag()
                    .on("start", _this.dragstarted)
                    .on("drag", _this.dragged)
                    .on("end", _this.dragended));
                return nodeEnter;
            },
            drawnodetext(nodetext) {
                var _this = this;
                var nodetextenter = nodetext.enter().append("text")
                    .style("fill", "#fff")
                    .attr("dy", 4)
                    .attr("font-family", "微软雅黑")
                    .attr("text-anchor", "middle")
                    .text(function (d) {
                        var length = d.name.length;
                        if (d.name.length > 4) {
                            var s = d.name.slice(0, 4) + "...";
                            return s;
                        }
                        return d.name;
                    });
                nodetextenter.on("mouseover", function (d, i) {
                    _this.timer = setTimeout(function () {
                        d3.select('#richContainer')
                            .style('position', 'absolute')
                            .style('left', d.x + "px")
                            .style('top', d.y + "px")
                            .style('display', 'block');
                        _this.editorcontent = "";
                        _this.showImageList = [];
                    }, 3000);
                });
                nodetextenter.on("dblclick", function (d) {

                    console.log("双击了"+d.name+"的文字中心")
                    // 双击更新节点名称
                });
                nodetextenter.on("click", function (d) {//点击文字中心
                    $('#link_menubar').hide();// 隐藏空白处右键菜单
                    _this.graphEntity = d;
                    _this.selectnodeid = d.uuid;
                    console.log("点击了"+d.name+"的文字中心")
                    createInfoAlert(d.uuid);

                });
                return nodetextenter;
            },
            drawnodesymbol(nodesymbol) {
                var _this = this;
                var symnol_path = "M566.92736 550.580907c30.907733-34.655573 25.862827-82.445653 25.862827-104.239787 0-108.086613-87.620267-195.805867-195.577173-195.805867-49.015467 0-93.310293 18.752853-127.68256 48.564907l-0.518827-0.484693-4.980053 4.97664c-1.744213 1.64864-3.91168 2.942293-5.59104 4.72064l0.515413 0.484693-134.69696 133.727573L216.439467 534.8352l0 0 137.478827-136.31488c11.605333-10.410667 26.514773-17.298773 43.165013-17.298773 36.051627 0 65.184427 29.197653 65.184427 65.24928 0 14.032213-5.33504 26.125653-12.73856 36.829867l-131.754667 132.594347 0.515413 0.518827c-10.31168 11.578027-17.07008 26.381653-17.07008 43.066027 0 36.082347 29.16352 65.245867 65.184427 65.245867 16.684373 0 31.460693-6.724267 43.035307-17.07008l0.515413 0.512M1010.336427 343.49056c0-180.25472-145.882453-326.331733-325.911893-326.331733-80.704853 0-153.77408 30.22848-210.418347 79.0528l0.484693 0.64512c-12.352853 11.834027-20.241067 28.388693-20.241067 46.916267 0 36.051627 29.16352 65.245867 65.211733 65.245867 15.909547 0 29.876907-6.36928 41.192107-15.844693l0.38912 0.259413c33.624747-28.030293 76.301653-45.58848 123.511467-45.58848 107.99104 0 195.549867 87.6544 195.549867 195.744427 0 59.815253-27.357867 112.71168-69.51936 148.503893l0 0-319.25248 317.928107 0 0c-35.826347 42.2912-88.654507 69.710507-148.340053 69.710507-107.956907 0-195.549867-87.68512-195.549867-195.805867 0-59.753813 27.385173-112.646827 69.515947-148.43904l-92.18048-92.310187c-65.69984 59.559253-107.700907 144.913067-107.700907 240.749227 0 180.28544 145.885867 326.301013 325.915307 326.301013 95.218347 0 180.02944-41.642667 239.581867-106.827093l0.13312 0.129707 321.061547-319.962453-0.126293-0.13312C968.69376 523.615573 1010.336427 438.71232 1010.336427 343.49056L1010.336427 343.49056 1010.336427 343.49056zM1010.336427 343.49056";// 定义回形针形状
                var nodesymbolEnter = nodesymbol.enter().append("path").attr("d", symnol_path);
                nodesymbolEnter.call(d3.drag()
                    .on("start", _this.dragstarted)
                    .on("drag", _this.dragged)
                    .on("end", _this.dragended));
                return nodesymbolEnter;
            },
            drawnodebutton(nodebutton) {
                var _this = this;
                var nodebuttonEnter = nodebutton.enter().append("g").append("use")//  为每个节点组添加一个 use 子元素
                    .attr("r", function(d){
                        return d.r;
                    })
                    .attr("xlink:href", "#out_circle") //  指定 use 引用的内容
                    .attr('class',function(d,i){
                        return 'buttongroup out_buttongroup_'+i;
                    })
                    .classed("circle_opreate", true);
                return nodebuttonEnter;
            },
            drawlink(link) {
                var _this = this;
                var linkEnter = link.enter().append("path")
                    .attr("stroke-width", 1)
                    .attr("stroke", "#fce6d4")
                    .attr("fill", "none")
                    .attr("id", function (d) {
                        return "invis_" + d.lk.sourceid + "-" + d.lk.name + "-" + d.lk.targetid;
                    })
                    .attr("marker-end", "url(#arrow)")
                ;// 箭头
                linkEnter.on("dblclick", function (d) {
                    _this.selectnodeid = d.lk.uuid;
                    if (_this.isdeletelink) {
                        _this.deletelink();
                    } else {
                        _this.updatelinkName();
                    }
                });
                linkEnter.on("contextmenu", function (d) {
                    var cc = $(this).offset();
                    app.selectnodeid = d.lk.uuid;
                    app.selectlinkname = d.lk.name;
                    d3.select('#link_menubar')
                        .style('position', 'absolute')
                        .style('left', cc.left + "px")
                        .style('top', cc.top + "px")
                        .style('display', 'block');
                    d3.event.preventDefault();// 禁止系统默认右键
                    d3.event.stopPropagation();// 禁止空白处右键
                });
                linkEnter.on("mouseenter", function (d) {
                    d3.select(this).style("stroke-width", "6").attr("stroke", "#ff9e9e").attr("marker-end", "url(#arrow2)");
                });
                linkEnter.on("mouseleave", function (d) {
                    d3.select(this).style("stroke-width", "1").attr("stroke", "#fce6d4").attr("marker-end", "url(#arrow)");
                });
                return linkEnter;
            },
            drawlinktext(link) {
                var linktextEnter = link.enter().append('text')
                    .style('fill', '#e3af85')
                    .append("textPath")
                    .attr("startOffset", "50%")
                    .attr("text-anchor", "middle")
                    .attr("xlink:href", function(d) {
                        return "#invis_" + d.lk.sourceid + "-" + d.lk.name + "-" + d.lk.targetid;
                    })
                    .style("font-size", 14)
                    .text(function (d) {
                        if (d.lk.name != '') {
                            return d.lk.name;
                        }
                    });
                linktextEnter.on("mouseover", function (d) {
                    app.selectnodeid = d.lk.uuid;
                    app.selectlinkname = d.lk.name;
                    var cc = $(this).offset();
                    d3.select('#link_menubar')
                        .style('position', 'absolute')
                        .style('left', cc.left + "px")
                        .style('top', cc.top + "px")
                        .style('display', 'block');
                });
                return linktextEnter;
            }
        }
    });
}
$(function () {
    $(".graphcontainer").bind("contextmenu", function (event) {
        app.svg.selectAll("use").classed("circle_opreate", true);
    });
    $("body").bind("mousedown", function (event) {
        if (!(event.target.id === "link_menubar" || $(event.target).parents("#link_menubar").length > 0)) {
            $("#link_menubar").hide();
        }
        if (!(event.target.id === "linkmenubar" || $(event.target).parents("#linkmenubar").length > 0)) {
            $("#linkmenubar").hide();
        }

    });
})
function search() {
    var content = $("#searchContent").val();
    $.ajax({
        type: "GET",
        contentType: "application/json",
        dataType: "json",
        url: "getNode?name=" + content, //访问的链接
        success: function (data) {  //成功的回调函数
            $("#app").empty();
            $("#app").html("<div id=\"graphcontainer\"  class=\"graphcontainer\"></div>\n" +
                "                <div class=\"svg-set-box\"></div>");
            jsondata = data;
            newApp();
        },
        error: function (e) {
            console.log(e)
            $("#app").empty();
            $("#app").html("<h1>无相应数据结果</h1>")
        }
    });
}
function searchContent(content) {
    $("#searchContent").val(content);
    $.ajax({
        type: "GET",
        contentType: "application/json",
        dataType: "json",
        url: "getNode?name=" + content, //访问的链接
        success: function (data) {  //成功的回调函数
            console.log(data)
            $("#app").empty();
            $("#app").html("<div id=\"graphcontainer\"  class=\"graphcontainer\"></div>\n" +
                "                <div class=\"svg-set-box\"></div>");
            jsondata = data;
            newApp();
        },
        error: function (e) {
            console.log(e)
            $("#app").empty();
            $("#app").html("<h1>无相应数据结果</h1>")
        }
    });
}
function createInfoAlert(id) {
    var data = jsondata[id];
    console.log(data);
    var htmlContent = "<table class=\"table table-bordered\">\n" +
        "  <caption>";
    if(data["img"]){
        if(data.type=="hero"){
            htmlContent=htmlContent+"<img src='heroImg/"+data.img+"'>"+data.name+"</caption>";
        }else{
            htmlContent=htmlContent+"<img src='zhuangbei/"+data.img+"'>"+data.name+"</caption>";
        }
    }else{
        htmlContent=htmlContent+"技能名称："+data.name+"</caption>";
    }
    htmlContent=htmlContent+"<thead>\n" +
        "    <tr>" +
        "      <th width='150px'>属性名</th>" +
        "      <th>属性值</th>" +
        "    </tr>" +
        "  </thead>" +
        "  <tbody>";
    var keynum = 0;
    for(var key in data){
        keynum++;
        if(key!="name"&&key!="type"&&key!="img"){
            htmlContent = htmlContent+"<tr>" +
                "      <td>"+key+"</td>" +
                "      <td>"+data[key]+"</td>" +
                "    </tr>";
        }
    }
    htmlContent = htmlContent+"</tbody></table>";
    if(keynum>8){
        layer.open({
            area: ['700px', '500px'],
            scrollbar: false,
            content: htmlContent
        });
    }else{
        layer.open({
            area: ['700px'],
            scrollbar: false,
            content: htmlContent
        });
    }
}
